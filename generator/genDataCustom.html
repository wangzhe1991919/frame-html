<html>
<head>
    <meta charset="utf-8">
    <title>generator</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../static/layui/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>自定义数据类型</legend>
</fieldset>


<!-- 数据列表 -->
<div style="float: left;width:29%;">
    <table id="genTypeTable" class="layui-table" lay-filter="genFilterTypeTable"></table>
</div>
<div style="float: left;width:69%;">
    <table id="genDataTable" class="layui-table" lay-filter="genFilterDataTable"></table>
</div>


<!-- 字段表单 -->
<div id="dataFormDiv" style="padding:10px;display: none;">
    <form class="layui-form" action="" id="fieldForm">
        <div class="layui-form-item">
            <label class="layui-form-label">类型名称</label>
            <div class="layui-input-block">
                <input type="text" id="name" name="name" lay-verify="title" autocomplete="off" placeholder="请输入需要新添加的类型名称" class="layui-input">
            </div>
        </div>
    </form>
</div>

<!-- 列表内按钮 -->
<script type="text/html" id="operTool">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script src="../static/layui/layui.js" charset="utf-8"></script>
<script src="../static/scripts/common.js"></script>

<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
</body>
</html>

<script>
    layui.use(['table','layer','form'], function(){
        var form = layui.form;
        var table = layui.table;
        var $ = layui.jquery;
        var layer = layui.layer; //独立版的layer无需执行这一句

        var typeTableOption = common.getNopageTableOption('#genTypeTable',common.url.getGenTypeList,[
            {field: 'id', title: '主键',sort: true},
            {field: 'name', title: '类型名称'},
            {field: 'toolbar', title: '操作', toolbar:'#operTool'}
        ]);

        var dataTableOption = common.getNopageTableOption('#genDataTable',common.url.getGenDataList,[
            {type:'checkbox'},
            {field: 'id', title: '主键',sort: true},
            {field: 'genTypeId', title: '所属类型'},
            {field: 'content', title: '内容'},
            {field: 'toolbar', title: '操作', toolbar:'#operTool'}
        ]);

        //渲染列表
        table.render(typeTableOption);
        var dataTableObj = table.render(dataTableOption);

        //监听头工具栏事件
        table.on('toolbar(genFilterTypeTable)', function(obj){
            switch(obj.event){
                case 'add':
                    common.layerOpen(layer,$,'dataFormDiv',500,200,function() {
                        insertGenType();
                    });
                    break;
                case 'delete' :
                    alert("shsnchu");
                    break;
                case 'update' :
                    alert("编辑");
                    break;
            };
        });

        //监听行的点击事件
        table.on('row(genFilterTypeTable)', function(obj){
            dataTableObj.reload({
                where : {
                    "genTypeId" : obj.data.id
                }
            })
        });

        table.on('tool(genFilterTypeTable)', function(obj){
            var data = obj.data;
            if(obj.event === 'del'){
                layer.confirm('确定删除？', function(index){
                    common.ajaxDefault($,common.url.deleteGenType,{"id":data.id},"DELETE",function(o){
                        table.render(typeTableOption);
                        layer.closeAll();
                        layer.alert("删除成功");
                    })
                });
            } else if(obj.event === 'edit'){
                layer.alert('编辑行：<br>'+ JSON.stringify(data))
            }
        });

        //添加确定
        function insertGenType() {
            common.ajaxObj($,common.url.insertGenType,{"name":$("#name").val()},"POST",function(o){
                table.render(typeTableOption);
                layer.closeAll();
                layer.alert("添加成功");
            });
        }


        /*var fieldType = [
            {"name":"主键","value":0},{"name":"用户名","value":1},{"name":"整数","value":2},
            {"name":"日期-年月日时分秒","value":3},{"name":"日期-年月日","value":4},{"name":"邮箱","value":6},
            {"name":"地址","value":7},{"name":"手机号","value":8},{"name":"身份证号","value":9},
            {"name":"英文字符串","value":10}
        ];

        for (var i = 0; i < fieldType.length; i++) {
            $("#type").append("<option value=\"" + fieldType[i].value + "\">" + fieldType[i].name + "</option>");
        }
        form.render("select");*/

    });
</script>
