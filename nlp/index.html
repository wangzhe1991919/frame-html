<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>nlpIndex</title>
    <link rel="stylesheet" type="text/css" href="../static/css/jquery.mloading.css">
    <script src="../static/jquery/jquery-3.3.1.min.js"></script>
    <script src="../static/jquery/jquery.mloading.js"></script>
    <script src="../static/scripts/common.js"></script>
    <script src="../static/scripts/tinymce/tinymce.min.js"></script>

</head>
<style>
   .result{width: 100%;height: 200px;}
   .modelInput{width: 50px;}
   .buttons button{margin-left: 30px;}
   #resultTextarea {width: 100%;height: 100%;}
</style>
<body>
<div>
    <div class="textareaDiv">
        <textarea id="contentTextarea" placeholder="请输入需要解析的文本"></textarea>
    </div>
    <div class="buttons">
        <table cellpadding="5px">
            <tr>
                <td>
                    所属模型：<input class="modelInput" value="default" />
                    <button onclick="">切换模型</button>
                    <button onclick="">持久化模型</button>
                </td>
                <td>
                    <button onclick="">学习</button>
                    <button onclick="setNature()">词性标注</button>
                </td>
                <td>
                    <button onclick="analyzeByModel()">分词</button>结果是否包含词性：<input type="checkbox" id="contailNature">
                </td>
            </tr>
        </table>
    </div>
    结果：
    <div class="result">
        <textarea id="resultTextarea" placeholder="分词结果"></textarea>
    </div>
</div>
</body>
</html>
<script>
    //原始富文本输入框html内容
    let initContentHtml = null;
    //原始输入框的纯内容
    let initContent = null;

    tinymce.init({
        selector: '#contentTextarea',
        height: '250px',
        menubar: false
    });

    /**
     * 获取富文本框中的内容（纯内容）
     * @returns
     */
    function getContentFromEditor() {
        let activeEditor = tinymce.activeEditor;
        let editBody = activeEditor.getBody();
        activeEditor.selection.select(editBody);
        let text = activeEditor.selection.getContent({format : 'text' });
        return text;
    }
    /**
     * 获取富文本框中的内容（带html格式）
     */
    function getHtmlFromEditor() {
        return tinymce.activeEditor.getContent();
    }

    /**
     * 设置带格式的数据到富文本编辑器中
     * @param content
     */
    function setContentToEditor(content) {
        tinymce.activeEditor.insertContent(content);
    }

    /**
     * 给文字上颜色
     */
    function colorWord(keyword,color) {
        if (!color) {color="yellow"}
        return "<span style='background-color: "+ color +";'>" + keyword + "</span>";
    }


    //重置富文本框内容
    function resetInitContent() {
        if (initContentHtml == null) {
            initContentHtml = getHtmlFromEditor();
        }
        if (initContent == null) {
            initContent = getContentFromEditor();
        } else if (initContent != getContentFromEditor()) {
            //此处应该清除关键字的标黄-bug
            //todo
            initContentHtml = getHtmlFromEditor();
        }
        setContentToEditor(initContentHtml);
    }
    /**
     * NLP分词
     * @param type
     */
    function analyzeByModel(type) {
        //纯文字
        let content = getContentFromEditor();
        let contentHtml = "";
        //是否包含词性
        let withNature = $("#contailNature").is(':checked')
        //构造参数
        let paraObj = {"content" : content,"nature" : withNature };
        //设置遮罩层
        $("body").mLoading("show");
        common.ajaxDefault($,common.url.nlpAnalyzeByModel,paraObj,"GET",function(o) {
            $(".resultEl").remove();
            $("body").mLoading("hide");
            let resultData = o.data;
            //结果textarea的数据
            let resultText = "";
            for (let i = 0; i < resultData.length; i++) {
                resultText += (resultData[i] + " ");
                let color = "";
                if (i%2 == 1) {
                    color = "#b2dba1";
                } else {
                    color = "#ffcc00";
                }
                if (withNature) {
                    contentHtml += colorWord(resultData[i].split("/")[0],color);
                } else {
                    contentHtml += colorWord(resultData[i],color);
                }
            }
            $("#resultTextarea").text(resultText);
            //将关键字标了底色后放到富文本编辑器中
            setContentToEditor(contentHtml);
        });
    }

    /**
     * 当分词结果不包含词性时，或者手动输入词性时，使用该方法可以自动标注词性
     */
    function setNature() {
        let content =  $("#resultTextarea").text();
        common.ajaxDefault($,common.url.nlpSetNature, {"content":content},"POST",function(o) {
            $("#resultTextarea").text(o.data);
        });
    }
</script>